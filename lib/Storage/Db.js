'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i < props.length;i++) {var descriptor=props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if('value' in descriptor)descriptor.writable = true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x8,_x9,_x10){var _again=true;_function: while(_again) {var object=_x8,property=_x9,receiver=_x10;desc = parent = getter = undefined;_again = false;if(object === null)object = Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc === undefined){var parent=Object.getPrototypeOf(object);if(parent === null){return undefined;}else {_x8 = parent;_x9 = property;_x10 = receiver;_again = true;continue _function;}}else if('value' in desc){return desc.value;}else {var getter=desc.get;if(getter === undefined){return undefined;}return getter.call(receiver);}}};function _interopRequireDefault(obj){return obj && obj.__esModule?obj:{'default':obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _inherits(subClass,superClass){if(typeof superClass !== 'function' && superClass !== null){throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass);}subClass.prototype = Object.create(superClass && superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__ = superClass;}var _Abstract=require('./Abstract');var _Abstract2=_interopRequireDefault(_Abstract);var _mongodb=require('mongodb');var Storage=(function(_AbstractStorage){_inherits(Storage,_AbstractStorage);function Storage(collection){_classCallCheck(this,Storage);_get(Object.getPrototypeOf(Storage.prototype),'constructor',this).call(this,collection);}_createClass(Storage,[{key:'get',value:function get(){var _this=this;var criteria=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];var options=arguments.length <= 1 || arguments[1] === undefined?{}:arguments[1];criteria = this._prepareCriteria(criteria);return new Promise(function(resolve,reject){_this.collection.find(criteria,options).toArray(function(err,items){if(err){return reject(new Error('Storage error in get()'));}resolve(items);});});}},{key:'getByPage',value:function getByPage(criteria){var page=arguments.length <= 1 || arguments[1] === undefined?1:arguments[1];var limit=arguments.length <= 2 || arguments[2] === undefined?15:arguments[2];var orderby=arguments.length <= 3 || arguments[3] === undefined?'id':arguments[3];var order=arguments.length <= 4 || arguments[4] === undefined?'asc':arguments[4];page = page > 0 || 1;var options={};options.limit = limit;options.skip = (page - 1) * limit;options.sort = [[orderby,order?'asc':'desc']];return this.get(criteria,options);}},{key:'insert',value:function insert(dataArray){var _this2=this;if(dataArray.constructor !== Array){throw new Error('DB insert: Expected array');}return new Promise(function(resolve,reject){_this2.collection.insert(dataArray,function(err,insertResult){if(err){return reject(new Error('Storage error: insert() ' + err.message));}var insertedDatas=insertResult.ops;resolve(insertedDatas);});});}},{key:'update',value:function update(criteria,newValues){var _this3=this;var options=arguments.length <= 2 || arguments[2] === undefined?{upsert:false,multi:true}:arguments[2];criteria = this._prepareCriteria(criteria);newValues = this._stripIdCriteria(newValues);return new Promise(function(resolve,reject){_this3.collection.update(criteria,{$set:newValues},options,function(err,updateResult){if(err){return reject(new Error('Storage error: update() ' + err.message));}resolve(updateResult.result.n);});});}},{key:'delete',value:function _delete(criteria){var _this4=this;criteria = this._prepareCriteria(criteria);return new Promise(function(resolve,reject){_this4.collection.remove(criteria,function(err,deleteResult){if(err){return reject(new Error('Storage error: delete() ' + err.message));}var affetctedRows=deleteResult.result.n;resolve(affetctedRows);});});}},{key:'_prepareCriteria',value:function _prepareCriteria(criteria){if(criteria._id && criteria._id.constructor === String){criteria._id = (0,_mongodb.ObjectId)(criteria._id);}return criteria;}},{key:'_stripIdCriteria',value:function _stripIdCriteria(criteria){if(criteria._id){delete criteria._id;}return criteria;}}]);return Storage;})(_Abstract2['default']);exports['default'] = Storage;module.exports = exports['default'];
//# sourceMappingURL=../Storage/Db.js.map