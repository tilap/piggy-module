'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i < props.length;i++) {var descriptor=props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if('value' in descriptor)descriptor.writable = true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}var Service=(function(){function Service(manager){_classCallCheck(this,Service);this._manager = manager;this._context = {};}_createClass(Service,[{key:'setContext',value:function setContext(key,value){this._context[key] = value;return this;}},{key:'setFullContext',value:function setFullContext(context){this._context = context;return this;}},{key:'get',value:function get(){var criteria=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];var options=arguments.length <= 1 || arguments[1] === undefined?{}:arguments[1];return this._manager.get(criteria,options);}},{key:'getOne',value:function getOne(){var _this=this;var criteria=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];var options=arguments.length <= 1 || arguments[1] === undefined?{}:arguments[1];return new Promise(function(resolve,reject){_this.get(criteria,options).then(function(vos){if(vos.length === 0){return resolve(null);}if(vos.length === 1){return resolve(vos[0]);}reject(new Error('get One has multiple results'));});});}},{key:'getOneByUniqueProperty',value:function getOneByUniqueProperty(property,value){var criteria={};criteria[property] = value;return this.getOne(criteria);}},{key:'getOneById',value:function getOneById(id){return this.getOneByUniqueProperty('_id',id);}},{key:'getByPage',value:function getByPage(){var criteria=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];var page=arguments.length <= 1 || arguments[1] === undefined?1:arguments[1];var limit=arguments.length <= 2 || arguments[2] === undefined?15:arguments[2];var orderby=arguments.length <= 3 || arguments[3] === undefined?'id':arguments[3];var order=arguments.length <= 4 || arguments[4] === undefined?'asc':arguments[4];page = page > 0?page:1;order = order === 'desc' || order === false || order === -1 || order === '-1'?'desc':'asc';var options={};options.limit = limit;options.skip = (page - 1) * limit;options.sort = [[orderby,order]];return this.get(criteria,options);}},{key:'insertOne',value:function insertOne(){var _this2=this;var data=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];var vo=this._manager.getNewVo(data);return new Promise(function(resolve,reject){_this2._manager.insertOne(vo)['catch'](function(err){return reject(err);}).then(function(vo){return resolve(vo);});});}},{key:'updateOne',value:function updateOne(id){var data=arguments.length <= 1 || arguments[1] === undefined?{}:arguments[1];return this.updateOneByUniqueProperty('_id',id,data);}},{key:'updateOneByUniqueProperty',value:function updateOneByUniqueProperty(property,value,newData){var _this3=this;return new Promise(function(resolve,reject){_this3.getOneByUniqueProperty(property,value).then(function(vo){if(null === vo){return reject('not found');}vo.setData(newData);return vo;}).then(function(vo){return _this3._manager.updateOne(vo).then(function(updatedVo){return resolve(updatedVo);})['catch'](function(err){return reject(err);});});});}},{key:'delete',value:function _delete(){var _this4=this;var criteria=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];return new Promise(function(resolve,reject){_this4.get(criteria)['catch'](function(err){return reject('Delete error: ' + err.message);}).then(function(vos){_this4._manager['delete'](vos).then(function(deletedCount){return resolve(deletedCount);})['catch'](function(error){return reject(error);});})['catch'](function(err){return reject('Delete error: ' + err.message);});});}},{key:'availableMethods',get:function get(){var childMethods=Object.getOwnPropertyNames(this.__proto__);var OwnMethods=Object.getOwnPropertyNames(Service.prototype);var methods=childMethods;OwnMethods.forEach(function(method){if(methods.indexOf(method) < 0){methods.push(method);}});return methods;}}]);return Service;})();exports['default'] = Service;module.exports = exports['default'];
//# sourceMappingURL=Service.js.map