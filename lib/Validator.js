'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i < props.length;i++) {var descriptor=props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if('value' in descriptor)descriptor.writable = true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _interopRequireDefault(obj){return obj && obj.__esModule?obj:{'default':obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}var _utilsValidatorLib=require('./utils/validatorLib');var _utilsValidatorLib2=_interopRequireDefault(_utilsValidatorLib);var _ValidationPropertyError=require('./ValidationPropertyError');var _ValidationPropertyError2=_interopRequireDefault(_ValidationPropertyError);var Validator=(function(){function Validator(){var vo=arguments.length <= 0 || arguments[0] === undefined?null:arguments[0];_classCallCheck(this,Validator);this._vo = vo;this.errors = {};}_createClass(Validator,[{key:'validateVo',value:function validateVo(){var _this=this;var properties=this._vo.constructor.getPropertiesNames();this.errors = {};properties.forEach(function(property){try{_this.constructor.checkProperty(property,_this._vo[property]);}catch(err) {_this.errors[property] = err;}});return this;}},{key:'hasError',value:function hasError(){return Object.keys(this.errors).length > 0;}}],[{key:'isPropertyUnique',value:function isPropertyUnique(property){return this.uniques.indexOf(property) > -1;}},{key:'isPropertyRequired',value:function isPropertyRequired(property){return this.required.indexOf(property) > -1;}},{key:'hasRulesFor',value:function hasRulesFor(property){return this.rules[property]?true:false;}},{key:'getRulesFor',value:function getRulesFor(property){return this.rules[property]?this.rules[property]:[];}},{key:'needToCheckProperty',value:function needToCheckProperty(property,value){var skipIfEmpty=!this.isPropertyRequired(property);var isEmpty=!Validator.validate('required',value);return isEmpty && skipIfEmpty?false:true;}},{key:'checkProperty',value:function checkProperty(property,value){var _this2=this;if(this.needToCheckProperty(property,value)){this.getRulesFor(property).forEach(function(validator){var args=validator.args || [];var skipIfEmpty=!_this2.isPropertyRequired(property);if(args.constructor !== Array){args = [args];}if(!_this2.validate(validator.fct,value,args,skipIfEmpty)){var error=new _ValidationPropertyError2['default'](property,'format',validator.msg);throw error;}});}return true;}},{key:'validate',value:function validate(fct,value){var args=arguments.length <= 2 || arguments[2] === undefined?[]:arguments[2];var skipIfEmpty=arguments.length <= 3 || arguments[3] === undefined?false:arguments[3];if(skipIfEmpty && !value){return true;}var funcArgs=[value].concat(args);if(fct.constructor === Function){return fct.apply(null,funcArgs);}if(fct.constructor === String){return _utilsValidatorLib2['default'][fct].apply(null,funcArgs);}throw new Error('Wrong validator function');}}]);return Validator;})();exports['default'] = Validator;Validator.initFromVoClass = function(ValidatorChild,properties){var ruleset={};var requiredProperties=[];var uniqueProperties=[];Object.keys(properties).forEach(function(name){var isRequired=properties[name].required && true === properties[name].required;var isUnique=properties[name].unique && true === properties[name].unique;var validators=properties[name].validators || [];ruleset[name] = [];if(isUnique){uniqueProperties.push(name);}if(isRequired){requiredProperties.push(name);}validators.forEach(function(itemCfg){if(!itemCfg.fct){throw new Error('Configuration error: validator need a fct');}ruleset[name].push({fct:itemCfg.fct,msg:itemCfg.msg || '',args:itemCfg.args || [],skipIfEmpty:!isRequired});});});Object.defineProperty(ValidatorChild,'rules',{enumerable:false,writable:false,configurable:false,value:ruleset});Object.defineProperty(ValidatorChild,'required',{enumerable:false,writable:false,configurable:false,value:requiredProperties});Object.defineProperty(ValidatorChild,'uniques',{enumerable:false,writable:false,configurable:false,value:uniqueProperties});};module.exports = exports['default'];
//# sourceMappingURL=Validator.js.map