'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _createClass=(function(){function defineProperties(target,props){for(var i=0;i < props.length;i++) {var descriptor=props[i];descriptor.enumerable = descriptor.enumerable || false;descriptor.configurable = true;if('value' in descriptor)descriptor.writable = true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _interopRequireDefault(obj){return obj && obj.__esModule?obj:{'default':obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}var _utilsCastValue=require('./utils/castValue');var _utilsCastValue2=_interopRequireDefault(_utilsCastValue);var ID_KEY='_id';var Vo=(function(){function Vo(){var data=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];_classCallCheck(this,Vo);this.resetData();this.setData(data);this._status = this.id?Vo.STATUS.SAVED:Vo.STATUS.NEW;}_createClass(Vo,[{key:'get',value:function get(key){var defaultValue=arguments.length <= 1 || arguments[1] === undefined?null:arguments[1];this.constructor.assumePropertyExists(key);return this.data[key]?this.data[key]:defaultValue;}},{key:'set',value:function set(key,value){this.constructor.assumePropertyExists(key);value = this.castVoPropertyValue(key,value);if(this.data[key] !== value){this.data[key] = value;this._updateStatus(Vo.STATUS.CHANGED);}return this;}},{key:'setData',value:function setData(){var _this=this;var data=arguments.length <= 0 || arguments[0] === undefined?{}:arguments[0];Object.keys(data).forEach(function(property){_this.set(property,data[property]);});return this;}},{key:'resetData',value:function resetData(){this.data = {};return this;}},{key:'castVoPropertyValue',value:function castVoPropertyValue(key,value){this.constructor.assumePropertyExists(key);try{return (0,_utilsCastValue2['default'])(value,this.constructor.getPropertyConfig(key).type);}catch(err) {throw new Error('Cast property failed for property "' + key + '": ' + err.message);}}},{key:'_updateStatus',value:function _updateStatus(newStatus){if(this.status === newStatus){return false;}var previousStatus=this.status;this._status = newStatus;this.statusChangeTrigger(previousStatus,newStatus);return true;}},{key:'statusChangeTrigger',value:function statusChangeTrigger(previousStatus,newStatus){}},{key:'id',get:function get(){return this.data[ID_KEY]?this.data[ID_KEY].toString():null;}},{key:'dto',get:function get(){return this.data;}},{key:'isNew',get:function get(){return this.status === Vo.STATUS.NEW;}},{key:'isChanged',get:function get(){return this.status === Vo.STATUS.CHANGED;}},{key:'isSaved',get:function get(){return this.status === Vo.STATUS.SAVED;}},{key:'status',get:function get(){return this._status;},set:function set(value){throw new Error('Vo Status cannot be changed');}}],[{key:'assumePropertyExists',value:function assumePropertyExists(property){if(!this.hasProperty(property)){throw new Error('The property ' + property + ' is not defined in ' + this.constructor.name);}}},{key:'hasProperty',value:function hasProperty(property){return this.getPropertiesNames().indexOf(property) > -1;}},{key:'getPropertiesNames',value:function getPropertiesNames(){return Object.keys(this._properties);}},{key:'getPropertyConfig',value:function getPropertyConfig(property){this.assumePropertyExists(property);return this._properties[property];}},{key:'getPropertyType',value:function getPropertyType(property){this.assumePropertyExists(property);return this.getPropertyConfig(property).type || null;}},{key:'getPropertyDefault',value:function getPropertyDefault(property){this.assumePropertyExists(property);return this.getPropertyConfig(property)['default'] || null;}},{key:'primaryKey',get:function get(){return ID_KEY;}}]);return Vo;})();exports['default'] = Vo;Object.defineProperty(Vo,'STATUS',{enumerable:false,writable:false,configurable:false,value:Object.freeze({NEW:'new',CHANGED:'changed',SAVED:'saved'})});Vo.init = function(VoChild,properties){var objectProperties={};Object.keys(properties).forEach(function(name){if(VoChild.hasOwnProperty(name)){throw new Error('Property ' + name + ' is a reserved keyname');}var cleanedProperty={};['type','default'].forEach(function(elmt){if(properties[name][elmt]){cleanedProperty[elmt] = properties[name][elmt];}});objectProperties[name] = cleanedProperty;Object.defineProperty(VoChild.prototype,name,{get:function get(){return this.get(name);},set:function set(value){this.set(name,value);}});});Object.defineProperty(VoChild,'_properties',{enumerable:false,writable:false,configurable:false,value:objectProperties});};module.exports = exports['default'];
//# sourceMappingURL=Vo.js.map