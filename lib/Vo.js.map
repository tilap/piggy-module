{"version":3,"sources":["Vo.js"],"names":[],"mappings":"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","file":"Vo.js","sourcesContent":["import { VoError } from './Errors';\nimport caster from './utils/castValue';\n\nlet ID_KEY= '_id';\n\nexport default class Vo {\n\n  constructor(data = {}) {\n    this.resetData();\n    this.setData(data);\n    this._status = this.id ? Vo.STATUS.SAVED : Vo.STATUS.NEW;\n  }\n\n  get id() {\n    return this.data[ID_KEY] ? this.data[ID_KEY].toString() : null;\n  }\n\n  get dto() {\n    return this.data;\n  }\n\n  get isNew() {\n    return this.status === Vo.STATUS.NEW;\n  }\n\n  get isChanged() {\n    return this.status === Vo.STATUS.CHANGED;\n  }\n\n  get isSaved() {\n    return this.status === Vo.STATUS.SAVED;\n  }\n\n  get(key, defaultValue=null) {\n    this.constructor.assumePropertyExists(key);\n    return this.data[key] ? this.data[key] : defaultValue;\n  }\n\n  set(key, value) {\n    this.constructor.assumePropertyExists(key);\n    value = this.castVoPropertyValue(key, value);\n    if (this.data[key] !== value) {\n      this.data[key]= value;\n      this._updateStatus(Vo.STATUS.CHANGED);\n    }\n    return this;\n  }\n\n  setData(data={}) {\n    Object.keys(data).forEach( property => {\n      this.set(property, data[property]);\n    });\n    return this;\n  }\n\n  resetData() {\n    this.data = {};\n    return this;\n  }\n\n  get status() {\n    return this._status;\n  }\n\n  set status(value) {\n    throw new VoError('Status cannot be changed');\n  }\n\n  castVoPropertyValue(key, value) {\n    this.constructor.assumePropertyExists(key);\n    try {\n      return caster(value, this.constructor.getPropertyConfig(key).type);\n    }\n    catch(err) {\n      throw new VoError('Cast property failed for property \"' + key + '\": ' + err.message);\n    }\n  }\n\n  _updateStatus(newStatus) {\n    if(this.status === newStatus) {\n      return false;\n    }\n    let previousStatus = this.status;\n    this._status = newStatus;\n    this.statusChangeTrigger(previousStatus, newStatus);\n    return true;\n  }\n\n  // @todo replace with event emitter\n  statusChangeTrigger(previousStatus, newStatus) {} // jshint ignore:line\n\n  static get primaryKey() {\n    return ID_KEY;\n  }\n\n  static assumePropertyExists(property) {\n    if(!this.hasProperty(property)) {\n      throw new VoError('The property ' + property + ' is not defined in ' + this.constructor.name);\n    }\n  }\n\n  static hasProperty(key) {\n    return this.getPropertiesNames().indexOf(key) > -1;\n  }\n\n  static getPropertiesNames() {\n    return Object.keys(this._properties);\n  }\n\n  static getPropertyConfig(key) {\n    this.assumePropertyExists(key);\n    return this._properties[key];\n  }\n\n  static getPropertyType(key) {\n    this.assumePropertyExists(key);\n    return this.getPropertyConfig(key).type || null;\n  }\n\n  static getPropertyDefault(key) {\n    this.assumePropertyExists(key);\n    return this.getPropertyConfig(key).default || null;\n  }\n\n  // static getPropertyValidators(key) {\n  //   this.assumePropertyExists(key);\n  //   return this.getPropertyConfig(key).validators || [];\n  // }\n\n  // static isPropertyUnique(key) {\n  //   this.assumePropertyExists(key);\n  //   return this.getPropertyConfig(key).unique || false;\n  // }\n\n  // static isPropertyRequired(key) {\n  //   this.assumePropertyExists(key);\n  //   return this.getPropertyConfig(key).required || false;\n  // }\n}\n\nObject.defineProperty(Vo, 'STATUS', {\n  enumerable: false,\n  writable: false,\n  configurable: false,\n  value: Object.freeze({\n    NEW: 'new',\n    CHANGED: 'changed',\n    SAVED: 'saved'\n  })\n});\n\nVo.init = function(VoChild, properties) {\n\n  let objectProperties = {};\n\n  Object.keys(properties).forEach((name) => {\n    if (VoChild.hasOwnProperty(name)) {\n      throw new Error('Property ' + name + ' is a reserved keyname');\n    }\n\n    let cleanedProperty = {};\n    ['type', 'default'].forEach( elmt => {\n      if(properties[name][elmt]) {\n        cleanedProperty[elmt] = properties[name][elmt];\n      }\n    });\n    objectProperties[name] = cleanedProperty;\n\n    Object.defineProperty(VoChild.prototype, name, {\n      get: function() {\n        return this.get(name);\n      },\n      set: function(value) {\n        this.set(name, value);\n      }\n    });\n  });\n\n  Object.defineProperty(VoChild, '_properties', {\n    enumerable: false,\n    writable: false,\n    configurable: false,\n    value: objectProperties\n  });\n};\n"],"sourceRoot":"/source/"}