{"version":3,"sources":["Service.js"],"names":[],"mappings":"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","file":"Service.js","sourcesContent":["/**\n * Execute any business request from business data. Mostly output Vo\n */\nexport default class Service {\n\n  /**\n   * @param {Manager} manager - manager a manager instance\n   */\n  constructor(manager) {\n    /**\n     * @type {Manager}\n     * @private\n     */\n    this._manager = manager;\n\n    /**\n     * @type {object}\n     * @private\n     */\n    this._context = {};\n  }\n\n  /**\n   * Store a context\n   *\n   * @param {string} key - the context key\n   * @param {?(number|string|Array|object)} value - the context value\n   * @return {self}\n   * @access public\n   */\n  setContext(key, value) {\n    this._context[key]=value;\n    return this;\n  }\n\n  /**\n   * Store and override all context\n   *\n   * @param {object} context - the context key\n   * @return {self}\n   * @access public\n   */\n  setFullContext(context) {\n    this._context = context;\n    return this;\n  }\n\n  /**\n   * Create a Vo from a data object\n   *\n   * @param {object} data -\n   * @return {Promise<Vo, Error>} - new Vo\n   * @access public\n   */\n  createOneFromData(data={}) {\n    let vo = this._manager.getNewVo(data);\n    return new Promise((resolve, reject) => {\n      this._manager.saveOne(vo)\n        .catch(err => {\n          return reject(err);\n        })\n        .then(vo => {\n          return resolve(vo);\n        });\n    });\n  }\n\n  /**\n   * Get a list of Vo\n   *\n   * @param {Object} criteria - mongodb-like criteria style\n   * @param {Object} options - mongodb-like options style\n   * @return {Promise<Vo[], Error>}\n   * @access public\n   */\n  get(criteria={}, options={}) {\n    return this._manager.get(criteria, options);\n  }\n\n  /**\n   * Get a paginated list of Vo\n   *\n   * @param {Object} criteria - mongodb-like criteria style\n   * @param {integer} page - the page to retrieve\n   * @param {integer} limit - number of item per page\n   * @param {string} orderby - a Vo property to order by\n   * @param {string} order - 'asc' or 'desc'\n   * @return {Promise<Vo[], Error>}\n   * @access public\n   */\n  getByPage(criteria, page=1, limit=15, orderby='id', order='asc') {\n    page = page > 0 ? page : 1;\n    order = (order==='desc' || order===false || order===-1 || order==='-1') ? 'desc' : 'asc';\n    let options = {};\n    options.limit = limit;\n    options.skip = (page-1) * limit;\n    options.sort = [[orderby, order]];\n    return this.get(criteria, options);\n  }\n\n  /**\n   * Get a Vo from its Id\n   *\n   * @param {string} id - the id of the Vo\n   * @return {Promise<Vo, Error>}\n   * @access public\n   */\n  getOneById(id) {\n    return this._manager.getOneById(id);\n  }\n\n  /**\n   * Update a Vo properties from a dataset\n   *\n   * @param {Object} data - a data object\n   * @return {Promise<Vo, Error>} - the updated Vo\n   * @access public\n   */\n  updateOneFromData(data, id) {\n    return new Promise((resolve, reject) => {\n      this.getOneById(id).then( vo => {\n        if(null===vo) {\n          return reject ('not found');\n        }\n        vo.setData(data);\n        return vo;\n      })\n      .then( vo => {\n        this._manager.saveOne(vo).then( vo => {\n          return resolve(vo);\n        })\n        .catch(err => {\n          return reject(err);\n        });\n      });\n    });\n  }\n\n  /**\n   * Delete a Vo from its id\n   *\n   * @param {string} id - the id of the Vo\n   * @return {Promise<boolean, Error>} - true if success, false if error, null if nothing to delete\n   * @access public\n   */\n  deleteOneById(id) {\n    return new Promise((resolve, reject) => {\n      this.getOneById(id).then( vo => {\n        if(null===vo) {\n          return resolve(null);\n        }\n        this._manager.deleteOne(vo).then( success => {\n          return resolve(success===true);\n        });\n      });\n    });\n  }\n\n  /**\n   * Get the list of Class available methods\n   *\n   * @return {String[]} - the list of the callable methods\n   * @access public\n   */\n  get availableMethods() {\n    let childMethods = Object.getOwnPropertyNames(this.__proto__);\n    let OwnMethods = Object.getOwnPropertyNames(Service.prototype);\n\n    let methods = childMethods;\n    OwnMethods.forEach( method => {\n      if(methods.indexOf(method) < 0) {\n        methods.push(method);\n      }\n    });\n    return methods;\n  }\n}\n"],"sourceRoot":"/source/"}